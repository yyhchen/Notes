# divergent branch error的三种解决办法及原理

---

以下是关于 `merge`、`rebase` 和 `fast-forward` 三种合并策略的详细解释，包括它们的使用方法、优缺点以及原理层面的说明。

### 1. `merge` 策略

#### 使用方法

使用 `git pull` 时，如果没有指定 `--rebase` 参数，默认情况下会使用 `merge` 策略。你也可以通过以下命令显式地使用 `merge`：

```bash
git pull --no-rebase origin main
```

#### 优点

1. **历史记录保留**：合并不会改变现有的提交历史记录，保留了原始的提交顺序。
2. **冲突易于解决**：合并冲突时，只需要解决当前合并操作的冲突，不会影响其他提交。

#### 缺点

1. **产生合并提交**：每次合并操作会生成一个新的合并提交记录，可能导致提交历史变得复杂。
2. **分叉历史**：合并会保留分叉的历史，导致提交历史图变得复杂，难以阅读。

#### 原理

合并策略会在当前分支和目标分支之间创建一个新的合并提交，这个提交包含了两者的所有更改。合并操作会保留所有的提交历史记录，因此可以清晰地看到合并前后的所有更改。

<br>
<br>

### 2. `rebase` 策略

#### 使用方法

可以通过以下命令使用 `rebase` 策略：

```bash
git pull --rebase origin main
```

或者设置为全局默认策略：

```bash
git config --global pull.rebase true
```

#### 优点

1. **线性历史**：重新应用提交会生成一个线性的提交历史，没有分叉，历史记录更清晰。
2. **简洁提交记录**：通过将本地提交重新应用到最新的远程分支，可以避免合并提交记录。

#### 缺点

1. **复杂冲突解决**：如果有多个提交，且每个提交都引发冲突，需要多次解决冲突，比较复杂。
2. **重写历史**：rebase 会重写提交历史，如果在公共仓库中使用，可能会导致其他协作者的混淆。

#### 原理

`rebase` 会将当前分支的提交一个一个地提取出来，并在目标分支的最新提交上重新应用。这会生成新的提交对象，历史记录会被重写成一条线性路径，使得提交历史更加简洁。

<br>
<br>

### 3. `fast-forward` 策略

#### 使用方法

可以通过以下命令使用 `fast-forward` 策略：

```bash
git pull --ff-only origin main
```

或者设置为全局默认策略：

```bash
git config --global pull.ff only
```

#### 优点

1. **无合并提交**：在可以快进合并的情况下，不会产生额外的合并提交，历史记录干净整洁。
2. **简单历史**：快进合并会直接将分支指向最新的提交，不会产生分叉。

#### 缺点

1. **限制多**：只有在目标分支没有新提交时，才能进行快进合并，否则会报错。
2. **不保留分叉历史**：如果需要保留分叉点和合并点的历史记录，快进合并无法满足这个需求。

#### 原理

`fast-forward` 策略只在目标分支没有新提交的情况下才有效。它会直接将当前分支指向目标分支的最新提交，不会产生新的提交记录。这种方式非常适合保持简单的历史记录，但要求分支之间没有冲突和新提交。

### 选择合并策略的场景

- **merge**：适合在需要保留完整历史记录的情况下使用，尤其是多人协作时，可以清晰地看到每次合并的历史。
- **rebase**：适合在个人开发或者想要保持线性历史的情况下使用，提交历史会更加整洁。
- **fast-forward**：适合在单独分支开发并定期同步主分支的情况下使用，可以保持简洁的提交历史。

