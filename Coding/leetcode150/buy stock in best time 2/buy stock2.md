# 122. 买卖股票的最佳时机 II

(mid)

---

给你一个整数数组 `prices` ，其中 `prices[i]` 表示某支股票第 `i` 天的价格。

在每一天，你可以决定是否购买和/或出售股票。你在任何时候 **最多** 只能持有 **一股** 股票。你也可以先购买，然后在 **同一天** 出售。

返回 你能获得的 **最大** 利润 。


<br>
<br>


### 算法思想
使用 **动态规划** 解决股票买卖问题，我们可以定义一个二维数组 `dp`，其中 `dp[i][0]` 表示第 `i` 天交易完后手里 **==没有股票==** 的最大利润，`dp[i][1]` 表示第 `i` 天交易完后手里 **==持有股票==** 的最大利润。
动态规划的状态转移方程如下：
1. `dp[i][0]` 可以从两个状态转移而来：
   - 如果第 `i` 天没有进行任何操作，那么 `dp[i][0] = dp[i-1][0]`；
   - 如果第 `i` 天卖出股票，那么 `dp[i][0] = dp[i-1][1] + prices[i]`。
   因此，`dp[i][0]` 的状态转移方程为：`dp[i][0] = max(dp[i-1][0], dp[i-1][1] + prices[i])`。
2. `dp[i][1]` 也可以从两个状态转移而来：
   - 如果第 `i` 天没有进行任何操作，那么 `dp[i][1] = dp[i-1][1]`；
   - 如果第 `i` 天买入股票，那么 `dp[i][1] = dp[i-1][0] - prices[i]`。
   因此，`dp[i][1]` 的状态转移方程为：`dp[i][1] = max(dp[i-1][1], dp[i-1][0] - prices[i])`。
初始状态为 `dp[0][0] = 0`（第一天没有股票，利润为0）和 `dp[0][1] = -prices[0]`（第一天买入股票，利润为负的股票价格）。
最终答案是 `dp[n-1][0]`，因为最后一天手里没有股票的利润一定是最大的。

<br>

**下面是使用动态规划解决这个问题的 C++ 代码：**
```cpp
class Solution {
public:
    int maxProfit(vector<int>& prices) {
        int n = prices.size();
        vector<vector<int>> dp(n, vector<int>(2, 0));
        dp[0][0] = 0;
        dp[0][1] = -prices[0];
        for (int i = 1; i < n; i++) {
            dp[i][0] = max(dp[i - 1][0], dp[i - 1][1] + prices[i]);
            dp[i][1] = max(dp[i - 1][1], dp[i - 1][0] - prices[i]);
        }
        return dp[n - 1][0];
    }
};
```
这段代码中，我们首先初始化 `dp` 数组，然后使用两个嵌套循环遍历价格数组和 `dp` 数组的每一天。根据状态转移方程更新 `dp` 数组的值。最后返回 `dp[n-1][0]` 作为最大利润。



<br>
<br>
<br>


---

# 动态规划思想

动态规划是一种解决多阶段决策问题的方法，==**它将问题分解为相互重叠的子问题，并通过求解子问题的最优解来构建原问题的最优解**==。动态规划通常适用于具有以下特征的题目：
1. **最优子结构**：问题的最优解包含其子问题的最优解。这意味着可以通过组合子问题的最优解来构造原问题的最优解。
2. **重叠子问题**：问题可以分解为多个子问题，这些子问题不是独立的，即一个子问题在求解过程中多次出现。
3. **无后效性**：一旦某个给定子问题的解被确定后，就不会再改变，不管在这之后会解决哪些子问题。
4. **状态转移方程**：每个阶段的选择可以基于前一阶段的状态通过一个明确的方程来表示。
当面对一个问题时，如果它具有上述特征，那么可以考虑使用动态规划来解决。确定状态转移方程的步骤通常包括：
1. **定义状态**：确定需要多少个变量来表示问题的子问题状态。在股票买卖问题中，我们使用 `dp[i][0]` 和 `dp[i][1]` 来表示第 `i` 天的状态。
2. **初始化状态**：确定初始状态，即边界条件。在股票买卖问题中，`dp[0][0] = 0` 和 `dp[0][1] = -prices[0]`。
3. **确定状态转移方程**：这是最关键的一步，需要根据问题的性质来确定如何从上一个状态转移到下一个状态。在股票买卖问题中，我们根据是否持有股票来更新每天的利润。
4. **考虑状态转移的顺序**：动态规划可以是自顶向下（通过递归和记忆化）或自底向上（通过迭代）。在股票买卖问题中，我们选择自底向上的方式，从第一天开始逐步计算到最后一天。
5. **计算最终结果**：根据状态转移方程计算出最终结果。在股票买卖问题中，最终结果是 `dp[n-1][0]`。
动态规划的关键在于找到正确描述问题状态的变量，并确定这些状态之间如何转移。这通常需要对问题进行深入的分析和理解，以及一定的直觉和经验。在实际应用中，可能需要多次尝试和修改才能得到正确的状态转移方程。
