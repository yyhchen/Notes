# 模型压缩

---


剪枝、量化、蒸馏与神经架构搜索等模型压缩方法为去除网络冗余提供了有效的解决方案。不同的模型压缩方法的特点如下：

| 方法 | 描述|适用层级 | 是否需要预训练模型  | 优点 | 缺点 |
|----------------|----------|----------|------------------------|------------|------|
| 模型剪枝 | 判断参数、通道、滤波、卷积层的显著性，并剪除不重要的部分|卷积层、全连接层 | 是  | 可以显著减少参数数量，便于在硬件上实现加速；结构化剪枝可以使网络变窄，便于在存储空间与运算速度上实现加速 | 非结构化剪枝会造成网络结构不规整，难以有效加速；结构化剪枝可能会造成与硬件平台不兼容，灵活性差 |
| 模型量化 | 基于权值共享、矩阵近似，减少参数及激活值的存储位数，降低内存开销|卷积层、全连接层 | 是  | 有不错的压缩量和网络性能，训练时间短，可以获得存储量小、计算量低和网络性能好的小型网络 | 量化后的权重和激活降低了网络的容量和特征图的质量，量化到特殊位置时，容易造成预测精度下降，另外会向梯度信息中引入噪声，导致基于梯度下降法的训练过程收敛难度增加 |
| 知识蒸馏 | 将softmax分类器输出作为软知识，作为训练学生网络的先验知识|卷积层、整个网络 | 是  |  训练简单，可以显著减少参数数量，容易与其他压缩方法组合使用实现更大程度压缩 | 网络训练时间长，需要训练教师和学生模型；特殊结构很难与卷积核和较小方向的网络结合使用，泛化性差 |
| 神经网络架构搜索 | 通过搜索算法来探索不同的网络结构，以找到最优的模型配置。|所有层 | 否，从头开始训练 |  能够自动化地发现高性能、资源高效的深度学习模型架构 | 通常需要大量的计算资源和时间，且结果可能受限于搜索空间的定义和搜索算法的选择 |


<br>
<br>
<br>



## 剪枝

模型剪枝分为了：结构化剪枝和 非结构化剪枝

<br>

### 结构化剪枝

结构化剪枝（Structured Pruning）是一种神经网络压缩技术，旨在通过移除网络中的一部分结构（如神经元、通道或层）来减少模型的计算量和存储需求，同时尽量保持模型的性能。与非结构化剪枝（Unstructured Pruning）不同，结构化剪枝移除的是网络中具有明确结构的组件，而非随机权重。

结构化剪枝的主要步骤包括：
1. **选择要剪枝的结构**：例如，选择要移除的卷积层中的某些通道。
2. **定义剪枝标准**：通常基于权重的大小或激活值来决定哪些结构应该被移除。
3. **应用剪枝**：根据定义的标准移除选定的结构。
4. **微调模型**：在剪枝后，通常需要对模型进行微调以恢复或保持其性能。

结构化剪枝可能会造成与硬件平台不兼容的原因主要有以下几点：

1. **硬件依赖性**：不同的硬件平台对神经网络的计算和存储有不同的优化。结构化剪枝可能会改变网络的结构，导致原本针对特定硬件优化的计算模式不再适用。例如，某些硬件可能对特定大小的卷积核或通道数有优化，而剪枝后的网络可能不再符合这些优化条件。

2. **内存布局**：结构化剪枝可能会改变网络的内存布局，导致原本针对特定内存布局优化的硬件无法高效地访问数据。例如，某些硬件可能对连续内存访问有优化，而剪枝后的网络可能需要更复杂的内存访问模式。

3. **计算图优化**：现代硬件平台通常会对神经网络的计算图进行优化，以提高计算效率。结构化剪枝可能会破坏这些优化，导致计算效率下降。

4. **特定硬件特性**：某些硬件平台可能有特定的特性或限制，例如对特定操作的支持或对数据类型的限制。结构化剪枝可能会引入这些硬件不支持的操作或数据类型，导致不兼容。

因此，在进行结构化剪枝时，需要考虑目标硬件平台的特性，并在剪枝后进行充分的测试和优化，以确保模型在目标硬件上的性能。


<br>

### 非结构化剪枝

非结构化剪枝（Unstructured Pruning）是另一种神经网络压缩技术，与结构化剪枝相对。非结构化剪枝不是移除网络中具有明确结构的组件（如神经元、通道或层），而是随机地或基于某些标准移除网络中的单个权重或连接。

非结构化剪枝的主要步骤包括：
1. **选择要剪枝的权重**：通常基于权重的大小或重要性来决定哪些权重应该被移除。
2. **应用剪枝**：根据定义的标准移除选定的权重。
3. **微调模型**：在剪枝后，通常需要对模型进行微调以恢复或保持其性能。

非结构化剪枝的优点是可以更精细地控制模型的稀疏性，有可能在保持模型性能的同时实现更高的压缩率。然而，非结构化剪枝也有其局限性：

1. **硬件不友好**：非结构化剪枝会导致网络中权重的分布变得不规则，这使得它对硬件不够友好。现代硬件加速器（如GPU）通常对规则的计算模式有更好的优化，而非结构化剪枝后的模型可能无法充分利用这些优化。

2. **计算效率问题**：由于非结构化剪枝会导致网络中存在大量的零权重，这可能会增加计算的复杂性，因为即使权重为零，也需要进行额外的判断和处理。

3. **内存访问效率低**：非结构化剪枝可能会导致内存访问模式变得不规则，从而降低内存访问的效率。

4. **稀疏矩阵操作的挑战**：非结构化剪枝后的模型通常需要使用稀疏矩阵操作，而稀疏矩阵操作在某些硬件平台上可能不被很好地支持，或者效率较低。

因此，尽管非结构化剪枝在理论上可以实现更高的压缩率，但在实际应用中，特别是在需要高效硬件加速的场景中，结构化剪枝可能更为实用和有效。