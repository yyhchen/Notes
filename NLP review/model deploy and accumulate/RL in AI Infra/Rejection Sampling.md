
---

Rejection Sampling（拒绝采样）是一种蒙特卡洛统计方法，用于从难以直接采样的目标分布中生成样本。其核心思想是通过一个易于采样的辅助分布（提议分布）生成候选样本，再通过概率判断决定是否接受这些样本，从而间接逼近目标分布。以下是该技术的综合解析：

---

### **一、基本原理与流程**
1. **核心要素**  
   • **目标分布**（p(x)）：需采样的复杂分布，如无法直接生成样本的复杂概率密度函数。
   • **提议分布**（q(x)）：易于采样的分布（如正态分布），需满足存在常数k，使得k*q(x) ≥ p(x)对所有x成立，即完全覆盖目标分布。
   • **接受概率**：通过计算 $p(x)/(k*q(x))$，生成随机数u∈[0,1]，若u≤该比值则接受样本，否则拒绝。

2. **步骤**  
3. 1. 从q(x)中生成候选样本x；  
4. 2. 计算接受概率α = p(x)/(k*q(x))；  
5. 3. 生成随机数u，若u ≤ α则接受x，否则丢弃；  
6. 4. 重复直至获得足够样本。

---

### **二、应用场景与变种**
1. **统计学与机器学习**  
   • **经典应用**：处理非标准化分布（如双伽马分布），通过提议分布生成样本并筛选。
   • **生成对抗网络（GAN）**：生成器G类似提议分布，判别器D模拟接受概率，但GAN的目标分布由判别器隐式学习，而非显式定义。
   • **大模型后训练**：在LLM（如DeepSeek-R1）中，通过生成多个候选回答，使用奖励模型筛选最优样本（Best-of-N策略），提升数据质量。例如，生成N个答案后保留得分最高的用于监督微调（SFT）。

2. **优化与扩展**  
   • **自适应拒绝采样（ARS）**：通过动态调整提议分布（如分段线性逼近目标分布），减少无效采样，适用于对数凹函数类分布。
   • **投机拒绝（Speculative Rejection）**：在大规模数据生成中提前终止低质量样本的生成，减少计算开销（如16-32倍加速）。

---

### **三、优缺点分析**
1. **优势**  
   • **无需归一化常数**：仅需目标分布与提议分布的比值，避免复杂积分计算。
   • **灵活性**：适用于高维或非标准化分布，可结合规则或模型动态调整标准。
   • **高质量筛选**：在LLM中用于生成高质量训练数据，如DeepSeek-R1通过规则奖励和神经奖励模型筛选60万条高质量样本。

2. **局限性**  
   • **效率依赖匹配度**：若q(x)与p(x)差异大，拒绝率高，计算成本剧增。
   • **高维挑战**：维度增加时，有效样本生成难度指数级上升（维度灾难），常需结合MCMC等方法。

---

### **四、与其他采样技术的对比**
| **方法**            | **特点**                                                                 | **适用场景**               |
|---------------------|-------------------------------------------------------------------------|--------------------------|
| **拒绝采样**          | 依赖提议分布覆盖目标分布，接受/拒绝机制直观                              | 低维空间、显式目标分布        |
| **重要性采样**        | 不拒绝样本，但通过权重修正计算期望值                                     | 积分计算、低拒绝率场景        |
| **MCMC（如Metropolis）** | 通过马尔可夫链逼近目标分布，收敛速度慢但适合高维空间                     | 复杂高维分布、稳态分布收敛     |

---

### **五、总结**
Rejection Sampling通过“试错”机制平衡了采样效率与分布精度，在统计学、生成模型和大模型训练中均有广泛应用。其核心价值在于将复杂采样问题转化为易于操作的接受-拒绝决策，但需结合场景优化提议分布或引入动态调整策略（如自适应方法）以提升效率。对于现代LLM而言，该技术不仅是数据生成的工具，更是提升模型对齐和输出质量的关键手段。