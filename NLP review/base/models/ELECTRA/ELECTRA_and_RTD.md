# ELECTRA and RTD任务

**参考资料**

- [ELECTRA: Pre-training Text Encoders as Discriminators Rather Than Generators](https://arxiv.org/abs/2003.10555)

- [完胜 BERT，谷歌优秀 NLP 预训练模型开源](https://www.51cto.com/article/612645.html)

---


### 核心思想 -RTD

ELECTRA 使用一种称为替换令牌检测（RTD）的新预训练任务，该任务在从所有输入位置（如：LM）学习的同时，训练双向模型（如：MLM）。

具体而言，ELECTRA 的目标是学习区分输入的词。它不使用掩码，而是从一个建议分布中采样词来替换输入，这解决了掩码带来的预训练和 fine-tune 不一致的问题。

然后模型再训练一个判别器，来预测每个词是原始词还是替换词。**而判别器的一个优点则是：** ==模型从输入的所有词中学习==，而不是像 MLM 那样，仅使用掩盖的词，因此计算更加有效。

正如很多开发者联想到的对抗学习方法，ELECTRA 确实受到到生成对抗网络的启发（GAN）。但不同的是，**模型采用的是最大似然而非对抗学习**。

**例如下图中**，单词「cooked」可以替换为「ate」。尽管这有些道理，但它并不适合整个上下文。预训练任务需要模型（即鉴别器）来确定原始输入中的哪些标记已被替换或保持相同。
![alt text](image.png)

**正是由于该模型的二进制分类任务适用于每个输入单词，而非仅有少量的掩码单词**（在 BERT 样式的模型中为 15％），因此，RTD 方法的效率比 MLM 高。这也解释了为什么 ELECTRA 只需更少的示例，就可以达到与其它语言模型相同性能的原因。

<br>
<br>

### 具体架构
替换令牌来自生成器的神经网络。**生成器的目标是训练掩码语言模型**，即给定输入序列后，按照一定的比例（通常 15%）将输入中的词替换成掩码；然后通过网络得到向量表示；之后再采用 softmax 层，来预测输入序列中掩盖位置的词。

尽管生成器的结构类似于 GAN，但由于难以将该方法应用于文本任务，因此得到的训练目标函数为掩盖词的最大似然。

之后，生成器和判别器共享相同的输入词嵌入。**判别器的目标是判断输入序列每个位置的词是否被生成器替换，如果与原始输入序列对应位置的词不相同，就判别为已替换**。

![alt text](image-1.png)


<br>
<br>

### 补充
在Electra模型中，RTD（Replaced Token Detection）任务是一种预训练任务，旨在通过对输入句子中的某些token进行替换，并要求模型预测哪些token被替换了来进行模型训练。RTD任务是Electra模型的核心组成部分之一，有助于提高模型对上下文理解和token级别的语义理解能力。

下面是RTD任务的详细解释：

1. **目标**：
   - RTD任务的主要目标是通过模型在输入句子中的某些token上进行替换，并要求模型预测哪些token被替换了来进行模型训练。这使得模型需要更好地理解上下文信息和语义关系，以正确地识别被替换的token。

2. **任务流程**：
   - 给定一个输入句子，首先从该句子中随机选择一些token，并将它们替换为特殊的MASK标记。这些被替换的token将作为模型的输入。(**生成器干的事**)
   - 接下来，模型被要求预测哪些token被替换了。也就是说，模型需要在经过替换的token位置上输出一个二元分类的概率分布，来表示该位置是否被替换了。（**判别器干的事**）

3. **训练目标**：
   - 在RTD任务中，模型的训练目标是最大化正确预测被替换token的概率，同时最小化其他token的概率。这可以通过最大化交叉熵损失函数来实现。

4. **作用**：
   - RTD任务有助于训练模型更好地理解语义和上下文信息。通过要求模型在替换token的位置进行预测，模型被迫更加深入地理解句子的语义内容，以便准确地识别被替换的token。

5. **优点**：
   - 相比于传统的掩码语言模型（Masked Language Model，比如BERT），RTD任务的优点在于它引入了更多的负例训练样本。传统的掩码语言模型只有在MASK标记的位置上有正确的标签，而RTD任务要求模型在被替换和未被替换的位置都有正确的标签，这有助于模型更好地学习语义和上下文信息。

总的来说，RTD任务是Electra模型中的一项重要预训练任务，通过要求模型预测被替换的token，有助于提高模型对语义和上下文的理解能力，进而提升模型在各种自然语言处理任务中的性能。